---

- name: install named
  yum:
    name: '{{ item }}'
    state: present
  with_items:
    - bind
    - bind-utils

- name: infranodes
  shell: host {{ hostvars[item]['inventory_hostname_short'] }}-{{ guid }}.oslab.opentlc.com ipa.opentlc.com |grep {{ guid }} |awk '{ print $4 }'
  with_items: groups['infranodes']
  register: infranodes

- name: restore selinux context for named
  command: restorecon -R /var/named

- name: create domain zone file
  template:
    src: zone.db.j2
    dest: /var/named/zones/{{domain}}.db
    owner: named
    group: named
  name: restart named

- name: configure named.conf
  template:
    src: named.conf.j2
    dest: /etc/named/named.conf
    owner: named
    group: named
  notify: restart named

- name: restore selinux context for named
  command: restorecon -R /etc/named.conf

